{"ast":null,"code":"var _jsxFileName = \"C:\\\\full_stack_project_v0.2\\\\frontend\\\\src\\\\pages\\\\DashboardPage.js\",\n  _s = $RefreshSig$();\n// src/pages/DashboardPage.js\nimport { useState, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport API from '../services/api';\nimport Dashboard from '../components/Dashboard';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst DashboardPage = () => {\n  _s();\n  const history = useHistory();\n  const [user, setUser] = useState(null);\n  const [projects, setProjects] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  // Fonction pour charger les projets (on l'appelle au départ + après chaque sauvegarde)\n  const loadProjects = async () => {\n    try {\n      const {\n        data\n      } = await API.get('/projects');\n      setProjects(data || []);\n    } catch (err) {\n      console.error('Erreur chargement projets', err);\n      setProjects([]);\n    }\n  };\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      history.push('/login');\n      return;\n    }\n    try {\n      const payload = JSON.parse(atob(token.split('.')[1]));\n      setUser(payload);\n    } catch (err) {\n      localStorage.removeItem('token');\n      history.push('/login');\n      return;\n    }\n    loadProjects().finally(() => setLoading(false));\n  }, [history]);\n\n  // ← NOUVEAU : recharge les projets quand on reçoit un événement Socket.io\n  useEffect(() => {\n    const socket = window.socket || require('../socket').default;\n    socket.on('projectUpdated', () => {\n      loadProjects();\n    });\n    return () => socket.off('projectUpdated');\n  }, []);\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"text-center py-20 text-2xl\",\n      children: \"Chargement...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 12\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"min-h-screen bg-gray-50\",\n    children: /*#__PURE__*/_jsxDEV(Dashboard, {\n      user: user,\n      projects: projects,\n      setProjects: setProjects // ← on passe setProjects pour le formulaire\n      ,\n      refreshProjects: loadProjects // ← on passe la fonction de refresh\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 58,\n    columnNumber: 5\n  }, this);\n};\n_s(DashboardPage, \"m34ghc3L/LlpW/R6Ih0UZiYQ3RY=\", false, function () {\n  return [useHistory];\n});\n_c = DashboardPage;\nexport default DashboardPage;\nvar _c;\n$RefreshReg$(_c, \"DashboardPage\");","map":{"version":3,"names":["useState","useEffect","useHistory","API","Dashboard","jsxDEV","_jsxDEV","DashboardPage","_s","history","user","setUser","projects","setProjects","loading","setLoading","loadProjects","data","get","err","console","error","token","localStorage","getItem","push","payload","JSON","parse","atob","split","removeItem","finally","socket","window","require","default","on","off","className","children","fileName","_jsxFileName","lineNumber","columnNumber","refreshProjects","_c","$RefreshReg$"],"sources":["C:/full_stack_project_v0.2/frontend/src/pages/DashboardPage.js"],"sourcesContent":["// src/pages/DashboardPage.js\r\nimport { useState, useEffect } from 'react';\r\nimport { useHistory } from 'react-router-dom';\r\nimport API from '../services/api';\r\nimport Dashboard from '../components/Dashboard';\r\n\r\nconst DashboardPage = () => {\r\n  const history = useHistory();\r\n  const [user, setUser] = useState(null);\r\n  const [projects, setProjects] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Fonction pour charger les projets (on l'appelle au départ + après chaque sauvegarde)\r\n  const loadProjects = async () => {\r\n    try {\r\n      const { data } = await API.get('/projects');\r\n      setProjects(data || []);\r\n    } catch (err) {\r\n      console.error('Erreur chargement projets', err);\r\n      setProjects([]);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('token');\r\n    if (!token) {\r\n      history.push('/login');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const payload = JSON.parse(atob(token.split('.')[1]));\r\n      setUser(payload);\r\n    } catch (err) {\r\n      localStorage.removeItem('token');\r\n      history.push('/login');\r\n      return;\r\n    }\r\n\r\n    loadProjects().finally(() => setLoading(false));\r\n  }, [history]);\r\n\r\n  // ← NOUVEAU : recharge les projets quand on reçoit un événement Socket.io\r\n  useEffect(() => {\r\n    const socket = (window.socket || require('../socket').default);\r\n    socket.on('projectUpdated', () => {\r\n      loadProjects();\r\n    });\r\n\r\n    return () => socket.off('projectUpdated');\r\n  }, []);\r\n\r\n  if (loading) {\r\n    return <div className=\"text-center py-20 text-2xl\">Chargement...</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <Dashboard \r\n        user={user} \r\n        projects={projects} \r\n        setProjects={setProjects}   // ← on passe setProjects pour le formulaire\r\n        refreshProjects={loadProjects}  // ← on passe la fonction de refresh\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DashboardPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}